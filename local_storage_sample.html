<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>WebStorage Sample</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>HTML5 WebStorage API のSample</h1>
      </header>

    <div class="wrapper">
      <nav>
        <ul><a href="#SessionStorage-Sample">Session Storageサンプル</a></ul>
        <ul><a href="#LocalStorage-Sample">Local Storageサンプル</a></ul>
        <ul><a href="#JSONStorage-Sample">JSON オブジェクトサンプル</a></ul>
        <ul><a href="#MultiLine-Sample">複数行トサンプル</a></ul>
        <ul><sub>headerの位置かsectionの位置を指定するcssがおかしいのでnavのリンクの飛び位置の描画位置がずれてるやん。。。</sub></ul>
      </nav>
      <section>
        <h3>
<a name="SessionStorage-Sample" class="anchor" href="#SessionStorage-Sample"><span class="octicon octicon-link"></span></a>Session Storageサンプル</h3>

<p>接続ごとに有効なStorage。もちろん"接続ごと"なので同一ページであってもタブや別ウィンドウは別セッション＝Storageの領域は共有できない。</p>

<p id="sessionStorageInputFields">
KEY:<input type="text" name="sessionStorageKeyInput" id="sessionStorageKeyInput" width="100"/> <br/>
VALUE:<input type="text" name="sessionStorageValueInput" id="sessionStorageValueInput" width="100"/>　
<input type="button" name="sessionStorageAdd" id="sessionStorageAdd" value="書き込み"/>
<input type="button" name="sessionStorageRemove" id="sessionStorageRemove" value="キー削除"/>
<input type="button" name="sessionStorageClear" id="sessionStorageClear" value="全削除"/>
</p>

<div id="sessionStorageValueField">
Session Storage (自動更新):
<pre>no data...</pre>
</div>

<script type="text/javascript">
	// 書き込みボタンクリック
	$('#sessionStorageAdd').click(function(){
		var k = $('#sessionStorageKeyInput').val();
		// キーが空白でなければ書き込み
		if(k!='') sessionStorage.setItem(k, $('#sessionStorageValueInput').val());
	});
	// 削除ボタンクリック
	$('#sessionStorageRemove').click(function(){
		var k = $('#sessionStorageKeyInput').val();
		// キーがあれば削除
		if(k!=''){
			sessionStorage.removeItem(k);
			// テキストボックスの値を空白に
			$('#sessionStorageInputFields>:text').val('');
		}
	});
	// 全削除
	$('#sessionStorageClear').click(function(){
		// キーがあれば削除
		sessionStorage.clear();
		// テキストボックスの値を空白に
		$('#sessionStorageInputFields>:text').val('');
	});
	// storageのデータをtargetにDump
	function storage_dump(storage,target) {
		var preField = $("#"+target+">pre");
		if(storage.length > 0) {
			preField.text("");
			$.each(storage, function(index){
				// 全データの列挙はkeyメソッドでインデクスからキー名に変換するのね。
				preField.html(preField.html() + storage.key(index) + ":" + storage[storage.key(index)]+"<br/>");
			});
		}
		else {
			preField.text("no data...");
		}
	};
	// 500ミリ秒ごとにsessionStorageをdump
	setInterval("storage_dump(sessionStorage, 'sessionStorageValueField')",500);
</script>

        <h3>
<a name="LocalStorage-Sample" class="anchor" href="#LocalStorage-Sample"><span class="octicon octicon-link"></span></a>Local Storageサンプル</h3>

<p>サイトごとに有効なStorage。ただしサイト全体で同一領域を共有するため、別ページや別ウィンドウでの操作も影響します。注意する必要あり。</p>

<p id="localStorageInputFields">
KEY:<input type="text" name="localStorageKeyInput" id="localStorageKeyInput" width="100"/> <br/>
VALUE:<input type="text" name="localStorageValueInput" id="localStorageValueInput" width="100"/>
<input type="button" name="localStorageAdd" id="localStorageAdd" value="書き込み"/>
<input type="button" name="localStorageRemove" id="localStorageRemove" value="キー削除"/>
<input type="button" name="localStorageClear" id="localStorageClear" value="全削除"/>
</p>
<div id="localStorageValueField">
Local Storage Values（自動更新）:
<pre>no data...</pre>
</div>

<script type="text/javascript">
	// 書き込みボタンクリック
	$('#localStorageAdd').click(function(){
		var k = $('#localStorageKeyInput').val();
		// キーが空白でなければ書き込み
		if(k!='') localStorage.setItem(k, $('#localStorageValueInput').val());
	});
	// 削除ボタンクリック
	$('#localStorageRemove').click(function(){
		var k = $('#localStorageKeyInput').val();
		// キーがあれば削除
		if(k!=''){
			localStorage.removeItem(k);
			// テキストボックスの値を空白に
			$('#localStorageInputFields>:text').val('');
		}
	});
	// 全削除
	$('#localStorageClear').click(function(){
		// 全削除
		localStorage.clear();
		// テキストボックスの値を空白に
		$('#localStorageInputFields>:text').val('');
		$('#jsonStorageInputFields>:text').val('');
	});
	//500ミリ秒ごとにlocalStorageをdump
	setInterval("storage_dump(localStorage, 'localStorageValueField')",500);
</script>

        <h3>
<a name="StoreJSON-Sample" class="anchor" href="#StoreJSON-Sample"><span class="octicon octicon-link"></span></a>JSON オブジェクトサンプル</h3>
<p>JSON使って"オブジェクト"を保存するサンプル。データはLocalStorageに保存してます。</p>
<p id="jsonStorageInputFields">
KEY:<input type="text" name="jsonStorageKeyInput" id="jsonStorageKeyInput" width="100"/> <br/>
User Name:<input type="text" name="jsonStorageUserName" id="jsonStorageUserName" width="100"/> <br/>
Comment:<input type="text" name="jsonStorageComment" id="jsonStorageComment" width="100"/> <br/>
Today's Target:<input type="text" name="jsonStorageTarget" id="jsonStorageTarget" width="100"/> <br/>
Lined Time:<input type="text" name="jsonStorageLined" id="jsonStorageLined" width="100"/> <br/>
<input type="button" name="jsonStorageAdd" id="jsonStorageAdd" value="書き込み"/>
<input type="button" name="jsonStorageGet" id="jsonStorageGet" value="読み込み"/>
<input type="button" name="jsonStorageRemove" id="jsonStorageRemove" value="キー削除"/>
</p>
<script type="text/javascript">
	// 書き込みボタンクリック
	$('#jsonStorageAdd').click(function(){
		var k = $('#jsonStorageKeyInput').val();
		// キーが空白でなければ書き込み
		if(k!='') {
			var jsonObj = {
				name : $('#jsonStorageUserName').val(),
				comment : $('#jsonStorageComment').val(),
				target : $('#jsonStorageTarget').val(),
				lined : $('#jsonStorageLined').val()
			};
			localStorage.setItem(k, JSON.stringify(jsonObj));
		}
	});
	// 読み込みボタンクリック
	$('#jsonStorageGet').click(function(){
		var k = $('#jsonStorageKeyInput').val();
		// キーが空白でなければ読み込み
		if(k!=''){
			var jsonObj = JSON.parse(localStorage[k]);
			
			if(jsonObj["name"]) $('#jsonStorageUserName').val(jsonObj.name);
			if(jsonObj["comment"]) $('#jsonStorageComment').val(jsonObj.comment);
			if(jsonObj["target"]) $('#jsonStorageTarget').val(jsonObj.target);
			if(jsonObj["lined"]) $('#jsonStorageLined').val(jsonObj.lined);
		}
	});
	// 削除ボタンクリック
	$('#jsonStorageRemove').click(function(){
		var k = $('#jsonStorageKeyInput').val();
		// キーがあれば削除
		if(k!=''){
			localStorage.removeItem(k);
			$('#jsonStorageInputFields>:text').val('');
		}
	});
</script>
        <h3>
<a name="MultiLine-Sample" class="anchor" href="#MultiLine-Sample"><span class="octicon octicon-link"></span></a>複数行サンプル</h3>
<p>
JSONの配列を利用して複数レコードを保存するサンプル。
jsonでは配列は1次元配列の組み合わせ（ジャグ配列）なので各配列要素数が異なっても構わない。
また、配列の値がオブジェクトでも構わない。（上記と組み合わせてOK）
もちろん配列の値のオブジェクトが配列の値を持っていても構わない。割と、何でも入る。（値を取得するプログラムがそれだけ複雑になるのでめんどくさいだけ）
</p>
<p id="multiLineStorageInputFields">
KEY:<input type="text" name="multiLineStorageKeyInput" id="multiLineStorageKeyInput" width="100" value="multiRecordSample"/> <br/>
RECORDS : <textarea name="multiLineStorageRecords" id="multiLineStorageRecords" width="100" height="100">
aaaa,bbbb,ccccc
dddd,eeee
ffff,gggg,hhhh,iiiii</textarea> <br/>
<input type="button" name="multiLineStorageAdd" id="multiLineStorageAdd" value="書き込み"/>
<input type="button" name="multiLineStorageGet" id="multiLineStorageGet" value="読み込み"/>
<input type="button" name="multiLineStorageRemove" id="multiLineStorageRemove" value="キー削除"/>
</p>
<script type="text/javascript">
	// 書き込みボタンクリック
	$('#multiLineStorageAdd').click(function(){
		var k = $('#multiLineStorageKeyInput').val();
		// キーが空白でなければ書き込み
		if(k!='') {
			var jsonObj = {
				record : []
			};
			// 改行＆カンマで分割してjsonObj.recordにジャグ配列を突っ込む
			$.each($('#multiLineStorageRecords').text().split(/\r?\n/), function(index,val){
				jsonObj.record[index] = val.split(/,/);
			});
			localStorage.setItem(k, JSON.stringify(jsonObj));
		}
	});
	// 読み込みボタンクリック
	$('#multiLineStorageGet').click(function(){
		var k = $('#multiLineStorageKeyInput').val();
		// キーが空白でなければ読み込み
		if(k!=''){
			var jsonObj = JSON.parse(localStorage[k]);
			if(jsonObj) {
				var $textarea = $('#multiLineStorageRecords');
				$textarea.val('');
				$.each(jsonObj.record, function(index, val) {
					$textarea.val(
						$textarea.val() + val.join(',') + "\n");
				});
			}
		}
	});
	// 削除ボタンクリック
	$('#multiLineStorageRemove').click(function(){
		var k = $('#multiLineStorageKeyInput').val();
		// キーがあれば削除
		if(k!=''){
			localStorage.removeItem(k);
			$('#multiLineStorageInputFields>:text').val('');
		}
	});
</script>
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/2014Camp-pro">2014Camp-pro</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
