<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9" lang="en"> <![endif]-->
<!-- Consider adding an manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en" itemscope itemtype="http://schema.org/Product"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/b/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>列's Enjoy!!</title>
  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <meta name="author" content="humans.txt">

  <link rel="shortcut icon" href="favicon.png" type="image/x-icon" />

  <!-- Facebook Metadata /-->
  <meta property="fb:page_id" content="" />
  <meta property="og:image" content="" />
  <meta property="og:description" content=""/>
  <meta property="og:title" content=""/>

  <!-- Google+ Metadata /-->
  <meta itemprop="name" content="">
  <meta itemprop="description" content="">
  <meta itemprop="image" content="">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <!-- We highly recommend you use SASS and write your custom styles in sass/_custom.scss.
     However, there is a blank style.css in the css directory should you prefer -->
  <link rel="stylesheet" href="css/gumby.css">
  <link rel="stylesheet" href="css/custom.css">

  <script src="js/libs/modernizr-2.6.2.min.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  <script type="text/javascript" src="https://skyway.io/dist/0.3/peer.js"></script>
  
  <script>
    var meObj = JSON.parse(localStorage.getItem("me"));
    var stateList = {};
    var storeList = {};
    var storeNameList = {};
    var peer = new Peer({
  		key: 'cc6f5bfa-ec91-11e3-8c36-09d78563cbeb',
  		debug: 3,
  	});
    
    /* peer.on('open', function(){
      alert("open start");
    });
    
    // Await connections from others
  	peer.on('connection', connect);
  	
  	function connect(c) {
  	  if (c.label === 'getRankValue') {
  	    var userObj = JSON.parse(localStorage.getItem('user_' + meObj.user_id));
  	    var storeObj = JSON.parse(localStorage.getItem('store_' + meObj.user_id));
  	    
  	    var userData = {
  	      "store_id" : meObj.user_id,
  	      "name" : storeObj.name,
  	      "state" : userObj.state
  	    };
  	    
  	    c.send(JSON.stringify(userData));
  	    c.on('data', function(data) {
  	      var getData = JSON.parse(data);
  	      storeList[data.store_id]++;
  	      storeNameList[data.store_id] = date.name;
  	      stateList[data.state]++;
  	      
  	      var rankArray = new Array(5);
  	      var idArray = new Array(5);
  	      storeList.each(function(index){
  	        for(i = 0 ; i < 5 ; i++){
  	          if(rankArray[i] < storeList[index]){
  	            for(x = 4; x > i; x--){
  	              rankArray[x] = rankArray[x - 1];
  	              idArray[x] = idArray[x - 1];
  	            }
  	            rankArray[i] = storeList[index];
  	            idArray = index;
  	          }
  	        }
  	      });
  	      
  	      for(i = 0; i < 5; i++){
  	        $('#checkIn' + no).innerHTML = storeNameList[idArray[i]]; 
  	      }
  	      
  	      
  	      stateList.each(function(index){
  	        for(i = 0 ; i < 5 ; i++){
  	          if(rankArray[i] < stateList[index]){
  	            for(x = 4; x > i; x--){
  	              rankArray[x] = rankArray[x - 1];
  	            }
  	            rankArray[i] = stateList[index];
  	          }
  	        }
  	      });
  	      
  	    });
  	  }
  	} */
  	
    $(window).load(function(){
            // 全てのユーザから情報を集める
      /* var req = new XMLHttpRequest();
     	loadText("https://skyway.io/active/list/cc6f5bfa-ec91-11e3-8c36-09d78563cbeb");
     	// リクエストする
     	function loadText(path) {
     		req.onreadystatechange = readyStateChange;
     		// リクエスト発行
     		req.open("get", path, true);
     		req.send("");
 	    }
 	    
 	    function readyStateChange() {
     		// 通信完了
     		if(req.readyState == 4) {
       			// テキスト扱いされてしまうので配列にする
       			var subText = req.responseText.replace(/\[|\]|\"/g, '');
       			var peerIdList = subText.split(',');
       			// 全員にチェックインリクエスト送る
       			for (var i=0; i<peerIdList.length; i++) {
           		var requestedPeer = peerIdList[i];
             			// リクエスト
             			c = peer.connect(requestedPeer, {
               				label: 'getRankValue',
               				serialization: 'none',
               				metadata: 'null'
             			});
             			c.on('open', function() {
             				connect(c);
             			});
             			c.on('error', function(err) { alert(err); });
   	        }
   		  }
 	    } */
 	    
 	    var storeList = new Array(5);
 	    storeList["0"] = 1;
 	    storeList["1"] = 1;
 	    storeList["2"] = 4;
 	    storeList["3"] = 3;
 	    storeList["4"] = 1;
 	    
 	    var storeNameList = new Array(5);
 	    storeNameList["0"] = "0号店";
 	    storeNameList["1"] = "1号店";
 	    storeNameList["2"] = "2号店";
 	    storeNameList["3"] = "3号店";
 	    storeNameList["4"] = "4号店";
 	    
 	    
 	    var rankArray = {};
  	  var idArray = {};
  	      for (var index in storeList){
  	        for(i = 0 ; i < 5 ; i++){
  	          if(rankArray[i] === null){
  	            rankArray[i] = storeList[index];
  	            idArray = index;
  	          }
  	          
  	          if(rankArray[i] <= storeList[index]){
  	            for(x = 4; x > i; x--){
  	              if((x + 1) < 4){
    	              rankArray[x] = rankArray[x - 1];
    	              idArray[x] = idArray[x - 1];
  	              }
  	            }
  	            rankArray[i] = storeList[index];
  	            idArray = index;
  	          }
  	        }
  	      }
  	      
  	      for(no = 0; no < 5; no++){
  	        $('#chackInRank').append('<tr><td>' + (no + 1) + '</td>' + 
  	                                 '<td class="content-name">' + storeNameList[idArray[no]] + '</td>' +
  	                                 '<td>' + rankArray[no] + "人" + '</td></tr>');
  	      }
    });
  </script>
  
</head>

<style>
  .btn,.drawer { margin-bottom:10px; }
  .drawer { text-align: center; }
  h1.lead { border-bottom: 1px dotted #ccc; margin-bottom: 30px; }
  h4.lead { margin-bottom:10px; }
  #icon_map ul li { font-size: 16px; }
  .smallify { font-size: 13px; }
  .modal h2, .modal .btn { margin: 5% 0 20px; }
  .ttip.example { float: left; background: #eee; border: 1px dotted #ccc; padding: 20px; }
</style>

<body>

  <!-- Grab Google CDN's jQuery, fall back to local if offline -->
  <!-- 2.0 for modern browsers, 1.10 for .oldie -->
  <script>
  var oldieCheck = Boolean(document.getElementsByTagName('html')[0].className.match(/\soldie\s/g));
  if(!oldieCheck) {
  document.write('<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"><\/script>');
  } else {
  document.write('<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"><\/script>');
  }
  </script>
  <script>
  if(!window.jQuery) {
  if(!oldieCheck) {
    document.write('<script src="js/libs/jquery-2.0.2.min.js"><\/script>');
  } else {
    document.write('<script src="js/libs/jquery-1.10.1.min.js"><\/script>');
  }
  }
  </script>
  
  <!--{共通ヘッダー ここから}-->
  <header class="navbar" id="nav1">
    <div class="row">
      <a class="toggle" gumby-trigger="#nav1 > .row > ul" href="#"><i class="icon-menu"></i></a>
      <h1 class="four columns logo">
        <a href="index.html">
          <img src="img/header_logo.png" gumby-retina />
        </a>
      </h1>
      <ul class="eight columns">
        <li><a href="chat.html"><i class="icon-chat"></i> チャット</a></li>
        <li><a href="map.html"><i class="icon-globe"></i> 行列MAP</a></li>
        <li><a href="ranking.html"><i class="icon-trophy"></i> ランキング</a></li>
        <li><a href="edit_profile.html"><i class="icon-user"></i> プロフィール編集</a></li>
        <li><a href="game.html"><i class="icon-star"></i> しりとり</a></li>
        <li><a href="checkout.html"><i class="icon-logout"></i> チェックアウト</a></li>
      </ul>
    </div>
  </header>
  <!--{共通ヘッダー ここまで}-->
  <div class="wrapper">





  <!--{コンテンツ ここから}-->
  <div class="row page-header">
    <div class="twelve columns">
      <h3><i class="icon-trophy"></i> ランキング</h3>
    </div>
  </div>
  <div class="row">
    <div class="twelve columns">
      <table class="striped rounded ranking">
        <thead>
          <tr>
            <td colspan="3"><i class="icon-location"></i> チェックイン数</td>
          </tr>
        </thead>
        <tbody id="chackInRank">
        </tbody>
      </table>
      <table class="striped rounded ranking">
        <thead>
          <tr>
            <td colspan="3"><i class="icon-map"></i> 行列好き都道府県</td>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td class="content-name" id='state1'>東京</td>
            <td>100人</td>
          </tr>
          <tr>
            <td>2</td>
            <td class="content-name" id='state2'>大阪</td>
            <td>50人</td>
          </tr>
          <tr>
            <td>3</td>
            <td class="content-name" id='state3'>神奈川</td>
            <td>40人</td>
          </tr>
          <tr>
            <td>4</td>
            <td class="content-name" id='state4'>兵庫</td>
            <td>30人</td>
          </tr>
          <tr>
            <td>5</td>
            <td class="content-name" id='state5'>北海道</td>
            <td>20人</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <!--{コンテンツ ここまで}-->




  </div>
  <div class="footer-fix"></div>
  </div>
  <!--{共通フッター ここから}-->
  <footer class="row footer">
    PRO Team @DEVCAMP 2014
  </footer>
  <!--{共通フッター ここまで}-->
  <!--
  Include gumby.js followed by UI modules followed by gumby.init.js
  Or concatenate and minify into a single file -->
  <script gumby-touch="js/libs" src="js/libs/gumby.js"></script>
  <script src="js/libs/ui/gumby.retina.js"></script>
  <script src="js/libs/ui/gumby.fixed.js"></script>
  <script src="js/libs/ui/gumby.skiplink.js"></script>
  <script src="js/libs/ui/gumby.toggleswitch.js"></script>
  <script src="js/libs/ui/gumby.checkbox.js"></script>
  <script src="js/libs/ui/gumby.radiobtn.js"></script>
  <script src="js/libs/ui/gumby.tabs.js"></script>
  <script src="js/libs/ui/gumby.navbar.js"></script>
  <script src="js/libs/ui/jquery.validation.js"></script>
  <script src="js/libs/gumby.init.js"></script>

  <!--
  Google's recommended deferred loading of JS
  gumby.min.js contains gumby.js, all UI modules and gumby.init.js

  Note: If you opt to use this method of defered loading,
  ensure that any javascript essential to the initial
  display of the page is included separately in a normal
  script tag.

  <script type="text/javascript">
  function downloadJSAtOnload() {
  var element = document.createElement("script");
  element.src = "js/libs/gumby.min.js";
  document.body.appendChild(element);
  }
  if (window.addEventListener)
  window.addEventListener("load", downloadJSAtOnload, false);
  else if (window.attachEvent)
  window.attachEvent("onload", downloadJSAtOnload);
  else window.onload = downloadJSAtOnload;
  </script> -->

  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

  <!-- Change UA-XXXXX-X to be your site's ID -->
  <!--<script>
  window._gaq = [['_setAccount','UAXXXXXXXX1'],['_trackPageview'],['_trackPageLoadTime']];
  Modernizr.load({
    load: ('https:' == location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js'
  });
  </script>-->

  <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you want to support IE 6.
     chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 7 ]>
  <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
  <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
  <![endif]-->

  </body>
</html>
